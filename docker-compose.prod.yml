services:
  duo-gym:
    image: ghcr.io/kilianmyspro/gymfamily/duo-gym:latest
    container_name: duo-gym
    restart: always
    ports:
      - "8081:80"
    depends_on:
      - backend
    environment:
      - NODE_ENV=production

  backend:
    image: ghcr.io/kilianmyspro/gymfamily/backend:latest
    container_name: duo-gym-backend
    restart: always
    ports:
      - "3002:3002"
    volumes:
      - ./backend/prisma:/app/prisma
    environment:
      - DATABASE_URL=file:/app/prisma/prod.db
      - JWT_SECRET=production-secret-change-me
      - PORT=3002
      - NODE_ENV=production
    command: sh -c "npx prisma db push && npm start"
